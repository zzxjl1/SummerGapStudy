(function(){var t={6499:function(t,e,s){"use strict";var o=s(9242),n=s(3396),a=s(7139);const r=t=>((0,n.dD)("data-v-26e68e1f"),t=t(),(0,n.Cn)(),t),i=["id"],u=r((()=>(0,n._)("div",{style:{height:"80px"}},null,-1))),l={class:"sub-box show"},c={key:0,class:"control-pannel"},d=r((()=>(0,n._)("i",{class:"iconfont icon-backward"},null,-1))),h=[d],f={key:0,class:"iconfont icon-play"},w={key:1,class:"iconfont icon-pause"},_=r((()=>(0,n._)("i",{class:"iconfont icon-forward"},null,-1))),p=[_];function v(t,e,s,o,r,d){return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n._)("h2",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(r.data,((t,e)=>((0,n.wg)(),(0,n.iD)("span",{key:e,id:t.id},(0,a.zw)(t.text),9,i)))),128))]),u,(0,n._)("div",l,[(0,n._)("div",{onClick:e[0]||(e[0]=t=>d.toggleNewsBroadcast())},[(0,n._)("i",{class:(0,a.C_)(["iconfont icon-speak fab fab-large",{on:r.news_broadcast_interval}])},null,2)])]),r.news_broadcast_interval?((0,n.wg)(),(0,n.iD)("div",c,[(0,n._)("a",{class:"btn",onClick:e[1]||(e[1]=t=>d.backwardNewsBroadcast())},h),(0,n._)("a",{class:"btn",onClick:e[2]||(e[2]=t=>d.playPauseNewsBroadcast())},[r.news_broadcast_paused?((0,n.wg)(),(0,n.iD)("i",f)):((0,n.wg)(),(0,n.iD)("i",w))]),(0,n._)("a",{class:"btn",onClick:e[3]||(e[3]=t=>d.forwardNewsBroadcast())},p)])):(0,n.kq)("",!0)],64)}var g=s(1419),b=s.n(g),y=s(2005),m={data(){return{data:null,newsBroadcastQueue:b(),tts_preload_threshold:2,news_broadcast_interval:null,news_broadcast_paused:!1,isPlaying:!1}},mounted(){this.fetch(),this.toggleNewsBroadcast()},methods:{splitParagraph(t){for(var e=[],s="",o=0;o<t.length;o++)"。"==t[o]||"，"==t[o]||"；"==t[o]||"？"==t[o]||"！"==t[o]?(e.push({type:"sub_sentence",text:s}),e.push({type:"punctuation",text:t[o]}),s=""):s+=t[o];return""!=s&&e.push({type:"sub_sentence",text:s}),e.forEach(((t,e)=>{t["id"]=e})),e},fetch(){var t;try{t=JS.fetch()}catch(e){t="测试，test。123！"}this.data=this.splitParagraph(t)},broadcast(){if(!this.news_broadcast_paused){var t=this.newsBroadcastQueue.front();if("unloaded"==t.sound.state()&&!t.sound._preload)return t.start_load_timestamp=new Date,void t.sound.load();if("loading"!=t.sound.state())if(this.isPlaying)console.log("wav file is playing...");else{var e=this;t.sound.once("play",(function(){var s=t.ui_element_id;e.isPlaying=!0,null!=s&&(document.getElementById(s).style.background="aquamarine",document.getElementById(s).scrollIntoView({behavior:"smooth",block:"center"}))})),t.sound.once("end",(function(){var s=t.ui_element_id;e.isPlaying=!1,null!=s&&(document.getElementById(s).style.background="none");var o=e.newsBroadcastQueue.dequeue();console.log("新闻播报完成：",o),0==e.newsBroadcastQueue.size()&&(e.stopBroadcastNews(),console.log("全部新闻播报完成，清除定时器"))})),t.sound.once("stop",(function(){var s=t.ui_element_id;e.isPlaying=!1,null!=s&&(document.getElementById(s).style.background="none")})),t.sound.once("loaderror",(function(){var t=e.newsBroadcastQueue.dequeue();e.$utils.speek("发生了读取错误",!0,!0),console.log("wav file load error",t)})),t.sound.once("playerror",(function(){var t=e.newsBroadcastQueue.dequeue();e.$utils.speek("发生了读取错误",!0,!0),console.log("wav file play error",t)})),t.sound.play(),this.newsBroadcastQueue.front_n(this.tts_preload_threshold).forEach((t=>{"unloaded"==t.sound.state()&&(t.sound.load(),t.start_load_timestamp=new Date,console.log("preload:",t))}))}else{console.log("wav file is still loading...");var s=(new Date-t.start_load_timestamp)/1e3;if(s>10){var o=this.newsBroadcastQueue.dequeue();console.log("wav file loading timeout",o),this.$utils.speek("发生了读取错误",!0,!0)}}}},add_to_broadcast_queue(t,e=null){if(!t.match(/^\s+$/)){var s=this.newsBroadcastQueue.size()<this.tts_preload_threshold;this.newsBroadcastQueue.enqueue({text_to_speek:t,ui_element_id:e,start_load_timestamp:s?new Date:null,sound:new y.Howl({src:[encodeURI(`${this.$utils.get_http_base_url()}/tts?text=${t}`)],html5:!1,preload:s,autoplay:!1,loop:!1,volume:1,format:["wav"],onload:function(){console.log("wav file loaded...")}})})}},broadcastSplited(t){t.forEach((t=>{switch(t.type){case"sub_sentence":this.add_to_broadcast_queue(`${t.text}`,t.id);break;case"punctuation":break}}))},initBroadcastNews(){this.add_to_broadcast_queue("下面开始播报"),this.broadcastSplited(this.data),this.add_to_broadcast_queue("播报完毕"),console.log(this.newsBroadcastQueue)},toggleNewsBroadcast(){this.news_broadcast_interval?this.stopBroadcastNews():this.startBroadcastNews()},startBroadcastNews(){this.initBroadcastNews(),this.news_broadcast_interval=setInterval((()=>{this.broadcast()}),500)},stopBroadcastNews(){clearInterval(this.news_broadcast_interval),this.news_broadcast_interval=null;var t=this.newsBroadcastQueue.front();t&&t.sound.stop(),this.newsBroadcastQueue.clear()},playPauseNewsBroadcast(){this.news_broadcast_paused=!this.news_broadcast_paused;var t=this.newsBroadcastQueue.front();this.news_broadcast_paused?(t.sound.pause(),this.$utils.speek("暂停",!0,!0)):t.sound.play()},backwardNewsBroadcast(){var t=this.newsBroadcastQueue.front();t.sound.stop(),this.newsBroadcastQueue.back()},forwardNewsBroadcast(){var t=this.newsBroadcastQueue.front();t.sound.stop(),this.newsBroadcastQueue.dequeue()}}},B=s(89);const k=(0,B.Z)(m,[["render",v],["__scopeId","data-v-26e68e1f"]]);var C=k;function N(t,e,s){try{JS.speek(t,e,s)}catch(o){console.log(t)}}function Q(t){try{JS.toast(t)}catch(e){console.log(t)}}function q(){var t;try{t=JS.get_token()}catch(e){t="KpMP6U1nySvocbAWdtx4qhTZgHmFuVRi"}return t}function x(t){try{JS.showNewsDetail(t)}catch(e){location.href=`/newsviewer.html?id=${t}`,console.log(e)}console.log(t)}function S(){var t;try{t=JS.get_httpBaseUrl()}catch(e){t="http://192.168.31.114:4000"}return t}function P(){var t;try{t=JS.get_wsBaseUrl()}catch(e){t="ws://192.168.31.114:4000"}return t}var D={speek:N,toast:Q,get_token:q,showNewsDetail:x,get_http_base_url:S,get_ws_base_url:P};const O=(0,o.ri)(C);O.config.globalProperties.$utils=D,O.mount("#app")},1419:function(t){class e{constructor(){this.count=0,this.lowestCount=0,this.items=[]}enqueue(t){this.items[this.count]=t,this.count++}dequeue(){if(this.isEmpty())return;let t=this.items[this.lowestCount];return this.lowestCount++,t}back(){return 0!=this.lowestCount&&(this.lowestCount--,!0)}front(){return this.items[this.lowestCount]}front_n(t){for(var e=[],s=0;s<t;s++){var o=this.items[this.lowestCount+s];if(void 0==o)break;e.push(o)}return e}isEmpty(){return this.count-this.lowestCount===0}size(){return this.count-this.lowestCount}clear(){this.count=0,this.lowestCount=0,this.items=[]}toString(){if(this.isEmpty())return"queue is null";let t=this.items[this.lowestCount];for(let e=this.lowestCount+1;e<this.count;e++)t=`${t},${this.items[e]}`;return t}}t.exports=new e}},e={};function s(o){var n=e[o];if(void 0!==n)return n.exports;var a=e[o]={exports:{}};return t[o].call(a.exports,a,a.exports,s),a.exports}s.m=t,function(){var t=[];s.O=function(e,o,n,a){if(!o){var r=1/0;for(c=0;c<t.length;c++){o=t[c][0],n=t[c][1],a=t[c][2];for(var i=!0,u=0;u<o.length;u++)(!1&a||r>=a)&&Object.keys(s.O).every((function(t){return s.O[t](o[u])}))?o.splice(u--,1):(i=!1,a<r&&(r=a));if(i){t.splice(c--,1);var l=n();void 0!==l&&(e=l)}}return e}a=a||0;for(var c=t.length;c>0&&t[c-1][2]>a;c--)t[c]=t[c-1];t[c]=[o,n,a]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var o in e)s.o(e,o)&&!s.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){s.j=483}(),function(){var t={483:0};s.O.j=function(e){return 0===t[e]};var e=function(e,o){var n,a,r=o[0],i=o[1],u=o[2],l=0;if(r.some((function(e){return 0!==t[e]}))){for(n in i)s.o(i,n)&&(s.m[n]=i[n]);if(u)var c=u(s)}for(e&&e(o);l<r.length;l++)a=r[l],s.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return s.O(c)},o=self["webpackChunkaisee_ui"]=self["webpackChunkaisee_ui"]||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))}();var o=s.O(void 0,[998],(function(){return s(6499)}));o=s.O(o)})();
//# sourceMappingURL=ocr.20b12114.js.map